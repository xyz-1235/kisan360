<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kisan360 | Global Agri-Commerce</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Plus Jakarta Sans', sans-serif; }
        .hide-scrollbar::-webkit-scrollbar { display: none; }
        .hide-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        .product-card:hover .product-image { transform: scale(1.05); }
        .glass { background: rgba(255, 255, 255, 0.8); backdrop-filter: blur(12px); }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .animate-fade-in { animation: fadeIn 0.4s ease-out forwards; }
        
        /* Heading shadow for better legibility on busy backgrounds */
        .text-shadow-lg {
            text-shadow: 0 4px 12px rgba(0,0,0,0.3);
        }
    </style>
</head>
<body class="bg-slate-50 text-slate-900 min-h-screen">

    <!-- Navigation -->
    <nav class="sticky top-0 z-50 glass border-b border-slate-200">
        <div class="max-w-7xl mx-auto px-4 h-20 flex items-center justify-between">
            <div class="flex items-center gap-3 cursor-pointer" onclick="navigateTo('marketplace')">
                <div class="bg-emerald-600 p-2.5 rounded-2xl shadow-lg shadow-emerald-200">
                    <i data-lucide="leaf" class="text-white w-6 h-6"></i>
                </div>
                <div>
                    <span class="text-xl font-extrabold tracking-tight text-slate-800">KISAN<span class="text-emerald-600">360</span></span>
                    <p class="text-[10px] uppercase tracking-widest text-slate-500 font-bold leading-none hidden sm:block">Commercial Portal</p>
                </div>
            </div>

            <div class="hidden md:flex flex-1 max-w-lg mx-8 relative">
                <i data-lucide="search" class="absolute left-4 top-1/2 -translate-y-1/2 text-slate-400 w-5 h-5"></i>
                <input id="searchInput" type="text" placeholder="Search crops, fertilizers, or logistics..." 
                    class="w-full pl-12 pr-4 py-3 bg-slate-100/50 border-none rounded-2xl focus:ring-2 focus:ring-emerald-500 transition-all outline-none text-sm">
            </div>

            <div class="flex items-center gap-2 sm:gap-6">
                <button onclick="navigateTo('history')" class="hidden sm:flex items-center gap-2 text-slate-600 hover:text-emerald-600 font-semibold text-sm transition-colors">
                    <i data-lucide="package" class="w-5 h-5"></i>
                    My Orders
                </button>
                <button onclick="navigateTo('cart')" class="relative p-2.5 bg-slate-100 rounded-2xl text-slate-600 hover:bg-emerald-50 hover:text-emerald-600 transition-all">
                    <i data-lucide="shopping-cart" class="w-6 h-6"></i>
                    <span id="cartCount" class="absolute -top-1 -right-1 bg-orange-500 text-white text-[10px] font-black w-5 h-5 flex items-center justify-center rounded-full hidden">0</span>
                </button>
                <button class="bg-slate-900 text-white px-6 py-3 rounded-2xl text-sm font-bold hover:bg-slate-800 transition-all shadow-xl shadow-slate-200">
                    Login
                </button>
            </div>
        </div>
    </nav>

    <!-- Main Content Area -->
    <main id="appContent" class="max-w-7xl mx-auto px-4 py-8">
        <!-- Content injected by JS -->
    </main>

    <footer class="bg-slate-900 text-slate-400 pt-20 pb-10 mt-20">
        <div class="max-w-7xl mx-auto px-4">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-12 mb-16">
                <div class="col-span-1 md:col-span-1">
                    <div class="flex items-center gap-2 mb-6">
                        <i data-lucide="leaf" class="text-emerald-500 w-8 h-8"></i>
                        <span class="text-2xl font-bold text-white">KISAN<span class="text-emerald-500">360</span></span>
                    </div>
                    <p class="text-sm leading-relaxed mb-8">Empowering India's agrarian economy through direct-to-industry digital commerce and global export pathways.</p>
                    <div class="flex gap-4">
                        <div class="w-10 h-10 rounded-xl bg-slate-800 flex items-center justify-center hover:bg-emerald-600 cursor-pointer transition-colors"><i data-lucide="globe" class="w-5 h-5 text-white"></i></div>
                        <div class="w-10 h-10 rounded-xl bg-slate-800 flex items-center justify-center hover:bg-emerald-600 cursor-pointer transition-colors"><i data-lucide="twitter" class="w-5 h-5 text-white"></i></div>
                        <div class="w-10 h-10 rounded-xl bg-slate-800 flex items-center justify-center hover:bg-emerald-600 cursor-pointer transition-colors"><i data-lucide="linkedin" class="w-5 h-5 text-white"></i></div>
                    </div>
                </div>
                <div>
                    <h4 class="text-white font-bold mb-6">Quick Links</h4>
                    <ul class="space-y-4 text-sm">
                        <li class="hover:text-emerald-400 cursor-pointer">Live Market Rates</li>
                        <li class="hover:text-emerald-400 cursor-pointer">Quality Lab Directory</li>
                        <li class="hover:text-emerald-400 cursor-pointer">Export Licenses</li>
                        <li class="hover:text-emerald-400 cursor-pointer">FPO Solutions</li>
                    </ul>
                </div>
                <div>
                    <h4 class="text-white font-bold mb-6">Support</h4>
                    <ul class="space-y-4 text-sm">
                        <li class="hover:text-emerald-400 cursor-pointer">Help Center</li>
                        <li class="hover:text-emerald-400 cursor-pointer">Track Logistics</li>
                        <li class="hover:text-emerald-400 cursor-pointer">Returns & Claims</li>
                        <li class="hover:text-emerald-400 cursor-pointer">Contact Us</li>
                    </ul>
                </div>
                <div>
                    <h4 class="text-white font-bold mb-6">Market Intel</h4>
                    <p class="text-xs mb-4">Get weekly commodity predictions and yield reports.</p>
                    <div class="flex gap-2">
                        <input type="email" placeholder="Email Address" class="bg-slate-800 border-none rounded-xl px-4 py-3 text-sm w-full focus:ring-1 ring-emerald-500 outline-none">
                        <button class="bg-emerald-600 text-white px-5 py-3 rounded-xl font-bold hover:bg-emerald-700 transition-colors">Join</button>
                    </div>
                </div>
            </div>
            <div class="border-t border-slate-800 pt-8 flex flex-col md:row justify-between items-center text-xs gap-4">
                <p>© 2024 Kisan 360 Digital Platforms. All Rights Reserved.</p>
                <div class="flex gap-8">
                    <span>Privacy Policy</span>
                    <span>Trading Terms</span>
                </div>
            </div>
        </div>
    </footer>

    <script>
        // --- DATA ---
        const CATEGORIES = [
            { id: 'crops', name: 'Crop Produce', icon: 'leaf', img: 'https://images.unsplash.com/photo-1500382017468-9049fed747ef?auto=format&fit=crop&q=80&w=400' },
            { id: 'animal', name: 'Animal-Based', icon: 'beef', img: 'https://images.unsplash.com/photo-1543852786-1cf6624b9987?auto=format&fit=crop&q=80&w=400' },
            { id: 'processed', name: 'Processed Goods', icon: 'package', img: 'https://images.unsplash.com/photo-1599599810694-b5ac4dd7c4c7?auto=format&fit=crop&q=80&w=400' },
            { id: 'seeds', name: 'Seeds & Planting', icon: 'sprout', img: 'https://images.unsplash.com/photo-1523348830342-d01f9fc11339?auto=format&fit=crop&q=80&w=400' },
            { id: 'byproducts', name: 'By-products', icon: 'recycle', img: 'https://images.unsplash.com/photo-1615811361523-6bd03d7748e7?auto=format&fit=crop&q=80&w=400' },
            { id: 'medicinal', name: 'Medicinal', icon: 'activity', img: 'https://images.unsplash.com/photo-1585518419759-5ed1d1a98f9e?auto=format&fit=crop&q=80&w=400' },
            { id: 'forestry', name: 'Forestry Allied', icon: 'trees', img: 'https://images.unsplash.com/photo-1518156677180-95a2893f3e9f?auto=format&fit=crop&q=80&w=400' },
            { id: 'aquaculture', name: 'Aquaculture', icon: 'fish', img: 'https://images.unsplash.com/photo-1546069901-ba9599a7e63c?auto=format&fit=crop&q=80&w=400' }
        ];

        const PRODUCTS = [
            // CROPS
            { id: 1, name: 'Sona Masuri Rice', category: 'crops', sub: 'Grains', price: 4500, unit: 'Quintal', rating: 4.8, location: 'Andhra Pradesh', img: 'https://images.unsplash.com/photo-1586201375761-83865001e31c?auto=format&fit=crop&q=80&w=600', bulk: true, desc: 'Premium aged white rice with delicate aroma and high culinary yield.' },
            { id: 101, name: 'Alphonso Mangoes', category: 'crops', sub: 'Fruits', price: 1200, unit: 'Crate (12kg)', rating: 5.0, location: 'Ratnagiri', img: 'https://images.unsplash.com/photo-1553279768-865429fa0078?auto=format&fit=crop&q=80&w=600', bulk: false, desc: 'GI-tagged Ratnagiri Hapus. Known for its rich, creamy texture and unique flavor.' },
            { id: 102, name: 'Byadgi Red Chillies', category: 'crops', sub: 'Spices', price: 3200, unit: 'Quintal', rating: 4.7, location: 'Karnataka', img: 'https://i.pinimg.com/1200x/11/fe/e7/11fee7bd6db305e2a54f990040d23586.jpg', bulk: true, desc: 'High oleoresin content chillies, famous for deep red color and low pungency.' },
            
            // ANIMAL-BASED
            { id: 2, name: 'A2 Desi Cow Ghee', category: 'animal', sub: 'Dairy', price: 1800, unit: 'Litre', rating: 4.9, location: 'Haryana', img: 'https://i.pinimg.com/1200x/c6/ae/4b/c6ae4bf564feb7410b9a6e5ce1673244.jpg', bulk: false, desc: 'Traditional bilona method ghee from grass-fed Gir cows. Pure nutritional gold.' },
            { id: 3, name: 'Raw Himalayan Honey', category: 'animal', sub: 'Honey', price: 320, unit: 'Kg', rating: 4.7, location: 'Himachal', img: 'https://i.pinimg.com/1200x/f9/1b/74/f91b745881f4101c75c6e0172698f054.jpg', bulk: true, desc: 'Unfiltered, enzyme-rich honey harvested from wild forest blooms.' },
            { id: 201, name: 'Organic Buffalo Milk', category: 'animal', sub: 'Dairy', price: 85, unit: 'Litre', rating: 4.6, location: 'Punjab', img: 'https://i.pinimg.com/736x/83/70/f7/8370f7797b90fc938329da38ef4cd6f4.jpg', bulk: true, desc: 'Full-fat fresh buffalo milk. Direct-from-farm collection with cold chain support.' },

            // PROCESSED GOODS
            { id: 4, name: 'Cold Pressed Mustard Oil', category: 'processed', sub: 'Oils', price: 210, unit: 'Litre', rating: 4.5, location: 'Rajasthan', img: 'https://images.unsplash.com/photo-1474979266404-7eaacbcd87c5?auto=format&fit=crop&q=80&w=600', bulk: true, desc: 'Traditionally extracted yellow mustard oil with high pungency and omega-3.' },
            { id: 301, name: 'Organic Jaggery Blocks', category: 'processed', sub: 'Sweeteners', price: 85, unit: 'Kg', rating: 4.8, location: 'Gujarat', img: 'https://i.pinimg.com/1200x/2b/e7/02/2be7022cc2d314253a9efa594ced97ed.jpg', bulk: true, desc: 'Chemical-free jaggery made from fresh sugarcane juice. Rich in iron and minerals.' },
            { id: 302, name: 'Sun-dried Tomatoes', category: 'processed', sub: 'Dried Goods', price: 650, unit: 'Kg', rating: 4.4, location: 'Maharashtra', img: 'https://www.daringgourmet.com/wp-content/uploads/2019/09/Dried-Tomatoes-3-square-500x375.jpg', bulk: false, desc: 'Intense flavor preserved through natural sun-drying. No artificial preservatives.' },

            // SEEDS & PLANTING
            { id: 7, name: 'Hybrid Corn Seeds', category: 'seeds', sub: 'Certified', price: 1200, unit: '25Kg Bag', rating: 4.7, location: 'Punjab', img: 'https://i.pinimg.com/736x/79/7c/fb/797cfb95b1c8ea0f3e3d136db8326edb.jpg', bulk: false, desc: 'High-germination drought-resistant hybrid seeds for commercial cropping.' },
            { id: 401, name: 'Kesar Mango Saplings', category: 'seeds', sub: 'Saplings', price: 250, unit: 'Per Sapling', rating: 4.9, location: 'Gujarat', img: 'https://images.unsplash.com/photo-1553279768-865429fa0078?auto=format&fit=crop&q=80&w=600', bulk: true, desc: 'Grafted Kesar mango plants. 2 years old, hardened and ready for transplantation.' },

            // BY-PRODUCTS
            { id: 5, name: 'Vermicompost Gold', category: 'byproducts', sub: 'Compost', price: 320, unit: '50Kg Bag', rating: 4.6, location: 'Maharashtra', img: 'https://images.unsplash.com/photo-1615811361523-6bd03d7748e7?auto=format&fit=crop&q=80&w=600', bulk: true, desc: 'Premium worm-casted organic fertilizer for intensive high-yield farming.' },
            { id: 501, name: 'Neem Bio-Pesticide', category: 'byproducts', sub: 'Organic Inputs', price: 450, unit: '5L Can', rating: 4.7, location: 'Tamil Nadu', img: 'https://images.unsplash.com/photo-1574943320219-553eb213f72d?auto=format&fit=crop&q=80&w=600', bulk: false, desc: 'Neem oil extract with high Azadirachtin content for natural pest control.' },
            { id: 502, name: 'Premium Wheat Straw', category: 'byproducts', sub: 'Fodder', price: 450, unit: 'Quintal', rating: 4.5, location: 'Haryana', img: 'https://images.unsplash.com/photo-1574943320219-553eb213f72d?auto=format&fit=crop&q=80&w=600', bulk: true, desc: 'Clean, dry wheat straw bales. High fiber content, ideal for cattle feed.' },

            // MEDICINAL
            { id: 601, name: 'Ashwagandha Root', category: 'medicinal', sub: 'Herbs', price: 950, unit: 'Kg', rating: 4.9, location: 'Madhya Pradesh', img: 'https://images.unsplash.com/photo-1585518419759-5ed1d1a98f9e?auto=format&fit=crop&q=80&w=600', bulk: true, desc: 'Dried whole roots of Withania somnifera. High withanolide content.' },
            { id: 602, name: 'Dried Tulsi Leaves', category: 'medicinal', sub: 'Herbs', price: 420, unit: 'Kg', rating: 4.8, location: 'Uttarakhand', img: 'https://images.unsplash.com/photo-1585518419759-5ed1d1a98f9e?auto=format&fit=crop&q=80&w=600', bulk: false, desc: 'Organic holy basil leaves, shade-dried to preserve essential oils.' },

            // FORESTRY
            { id: 6, name: 'Bamboo Construction Poles', category: 'forestry', sub: 'Timber', price: 2800, unit: '100 Poles', rating: 4.9, location: 'Assam', img: 'https://images.unsplash.com/photo-1518156677180-95a2893f3e9f?auto=format&fit=crop&q=80&w=600', bulk: true, desc: 'A-grade seasoned bamboo poles, straight and treated for durability.' },
            { id: 701, name: 'Wild Oyster Mushrooms', category: 'forestry', sub: 'Wild Produce', price: 850, unit: '500g Dried', rating: 4.7, location: 'Meghalaya', img: 'https://images.unsplash.com/photo-1504674900247-0877df9cc836?auto=format&fit=crop&q=80&w=600', bulk: false, desc: 'Forest-harvested oyster mushrooms, naturally dried and umami-rich.' },

            // AQUACULTURE
            { id: 8, name: 'Fresh Catla Seeds', category: 'aquaculture', sub: 'Fish Seed', price: 950, unit: '1000 Count', rating: 4.8, location: 'Bengal', img: 'https://images.unsplash.com/photo-1546069901-ba9599a7e63c?auto=format&fit=crop&q=80&w=600', bulk: true, desc: 'Laboratory certified disease-free fingerlings for intensive aquaculture.' },
            { id: 801, name: 'Seaweed Extract (Liquid)', category: 'aquaculture', sub: 'Bio-stimulant', price: 680, unit: '5L Can', rating: 4.6, location: 'Tamil Nadu', img: 'https://images.unsplash.com/photo-1546069901-ba9599a7e63c?auto=format&fit=crop&q=80&w=600', bulk: true, desc: 'Concentrated seaweed extract from Sargassum. Boosts crop growth and immunity.' }
        ];

        // --- STATE ---
        let state = {
            view: 'marketplace',
            activeCategory: 'all',
            search: '',
            cart: [],
            orderHistory: JSON.parse(localStorage.getItem('kisan360_orders') || '[]')
        };

        // --- CORE FUNCTIONS ---
        function navigateTo(view) {
            state.view = view;
            render();
            window.scrollTo(0,0);
        }

        function addToCart(productId) {
            const product = PRODUCTS.find(p => p.id === productId);
            const existing = state.cart.find(item => item.id === productId);
            if (existing) {
                existing.qty++;
            } else {
                state.cart.push({ ...product, qty: 1 });
            }
            updateCartCounter();
            render(); // Refresh to show feedback
        }

        function removeFromCart(productId) {
            state.cart = state.cart.filter(item => item.id !== productId);
            updateCartCounter();
            render();
        }

        function updateQty(productId, delta) {
            const item = state.cart.find(i => i.id === productId);
            if (item) {
                item.qty = Math.max(1, item.qty + delta);
                render();
            }
        }

        function updateCartCounter() {
            const total = state.cart.reduce((acc, curr) => acc + curr.qty, 0);
            const counter = document.getElementById('cartCount');
            if (total > 0) {
                counter.innerText = total;
                counter.classList.remove('hidden');
            } else {
                counter.classList.add('hidden');
            }
        }

        // --- RENDERERS ---
        function render() {
            const container = document.getElementById('appContent');
            
            switch(state.view) {
                case 'marketplace':
                    renderMarketplace(container);
                    break;
                case 'cart':
                    renderCart(container);
                    break;
                case 'checkout':
                    renderCheckout(container);
                    break;
                case 'confirmation':
                    renderConfirmation(container);
                    break;
                case 'history':
                    renderHistory(container);
                    break;
            }
            lucide.createIcons();
        }

        function renderMarketplace(container) {
            const filtered = PRODUCTS.filter(p => {
                const matchesCat = state.activeCategory === 'all' || p.category === state.activeCategory;
                const matchesSearch = p.name.toLowerCase().includes(state.search.toLowerCase());
                return matchesCat && matchesSearch;
            });

            container.innerHTML = `
                <div class="animate-fade-in">
                    <!-- Improved Hero Section -->
                    <div class="relative h-[28rem] sm:h-[32rem] rounded-[2.5rem] overflow-hidden mb-12 shadow-2xl group/hero">
                        <img src="https://images.unsplash.com/photo-1495107334217-fc6df44ef133?auto=format&fit=crop&q=80&w=1200" 
                             class="w-full h-full object-cover group-hover/hero:scale-105 transition-transform duration-1000">
                        
                        <!-- Stronger gradient overlay for guaranteed text legibility -->
                        <div class="absolute inset-0 bg-gradient-to-r from-slate-900/90 via-slate-900/60 to-transparent flex items-center p-8 sm:p-20">
                            <div class="max-w-2xl">
                                <div class="inline-flex items-center gap-2 bg-emerald-500 text-white text-[10px] font-black uppercase tracking-[0.25em] px-4 py-1.5 rounded-full mb-6 shadow-lg shadow-emerald-500/20">
                                    <i data-lucide="shield-check" class="w-3 h-3"></i>
                                    Direct From Farm
                                </div>
                                <h1 class="text-4xl sm:text-6xl font-extrabold text-white mb-6 leading-[1.1] tracking-tight text-shadow-lg">
                                    Secure High-Grade <br/>
                                    <span class="text-emerald-400">Agri-Commodities</span>
                                </h1>
                                <p class="text-slate-100 text-base sm:text-xl mb-10 opacity-90 leading-relaxed max-w-lg">
                                    Unified commercial marketplace connecting verified industrial buyers directly to Indian primary producers.
                                </p>
                                <div class="flex flex-wrap gap-4">
                                    <button onclick="window.scrollTo({top: 800, behavior: 'smooth'})" class="bg-emerald-600 hover:bg-emerald-500 text-white px-10 py-4 rounded-2xl font-bold transition-all shadow-xl shadow-emerald-900/40 active:scale-95">
                                        Explore Market
                                    </button>
                                    <button class="bg-white/10 hover:bg-white/20 backdrop-blur-xl text-white border border-white/30 px-10 py-4 rounded-2xl font-bold transition-all active:scale-95">
                                        Become Partner
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="flex flex-col lg:flex-row gap-10">
                        <!-- Sidebar -->
                        <aside class="lg:w-72 flex-shrink-0">
                            <div class="sticky top-28 space-y-8">
                                <div>
                                    <h3 class="text-xs font-bold text-slate-400 uppercase tracking-widest mb-6">Trade Categories</h3>
                                    <div class="grid grid-cols-2 lg:grid-cols-1 gap-2">
                                        <button onclick="state.activeCategory = 'all'; render()" class="flex items-center gap-3 px-4 py-3.5 rounded-2xl text-sm font-bold transition-all ${state.activeCategory === 'all' ? 'bg-emerald-600 text-white shadow-lg shadow-emerald-200' : 'hover:bg-white text-slate-600'}">
                                            <i data-lucide="layout-grid" class="w-5 h-5"></i> All Sectors
                                        </button>
                                        ${CATEGORIES.map(cat => `
                                            <button onclick="state.activeCategory = '${cat.id}'; render()" class="flex items-center gap-3 px-4 py-3.5 rounded-2xl text-sm font-bold transition-all ${state.activeCategory === cat.id ? 'bg-emerald-600 text-white shadow-lg shadow-emerald-200' : 'hover:bg-white text-slate-600'}">
                                                <i data-lucide="${cat.icon}" class="w-5 h-5"></i> ${cat.name}
                                            </button>
                                        `).join('')}
                                    </div>
                                </div>
                                <div class="bg-gradient-to-br from-slate-900 to-slate-800 p-6 rounded-[2rem] text-white shadow-2xl relative overflow-hidden">
                                    <i data-lucide="trending-up" class="absolute -bottom-6 -right-6 w-32 h-32 opacity-10 rotate-12"></i>
                                    <h4 class="font-bold mb-2">Market Insights</h4>
                                    <p class="text-[11px] text-slate-400 mb-4 leading-relaxed">Rice prices expected to surge by 4% in coming weeks due to export policy shifts.</p>
                                    <button class="w-full bg-emerald-600 py-3 rounded-xl text-xs font-bold hover:bg-emerald-500 transition-all">View Report</button>
                                </div>
                            </div>
                        </aside>

                        <!-- Products -->
                        <div class="flex-1">
                            <div class="flex justify-between items-end mb-8">
                                <div>
                                    <h2 class="text-2xl font-black text-slate-800">${state.activeCategory === 'all' ? 'Live Listings' : CATEGORIES.find(c => c.id === state.activeCategory).name}</h2>
                                    <p class="text-sm text-slate-500 mt-1">Found ${filtered.length} verified commercial lots</p>
                                </div>
                                <div class="hidden sm:block">
                                    <select class="bg-white border-none rounded-xl px-4 py-2 text-xs font-bold shadow-sm ring-1 ring-slate-200 outline-none">
                                        <option>Recommended</option>
                                        <option>Price: Low to High</option>
                                        <option>Verified First</option>
                                    </select>
                                </div>
                            </div>

                            <div class="grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-3 gap-6">
                                ${filtered.map(product => `
                                    <div class="product-card group bg-white rounded-[2rem] border border-slate-100 overflow-hidden hover:shadow-2xl hover:shadow-slate-200 transition-all duration-500">
                                        <div class="relative aspect-[16/11] overflow-hidden bg-slate-100">
                                            <img src="${product.img}" class="product-image w-full h-full object-cover transition-transform duration-700">
                                            <div class="absolute top-4 left-4 flex gap-2">
                                                ${product.bulk ? `<span class="bg-orange-500 text-white text-[9px] font-black uppercase px-2 py-1 rounded-lg shadow-lg">Bulk Lot</span>` : ''}
                                                <span class="bg-white/90 backdrop-blur text-slate-800 text-[9px] font-bold px-2 py-1 rounded-lg shadow-sm border border-white/40 flex items-center gap-1">
                                                    <i data-lucide="check-circle-2" class="w-2.5 h-2.5 text-emerald-600"></i> Quality Verified
                                                </span>
                                            </div>
                                        </div>
                                        <div class="p-6">
                                            <div class="flex justify-between items-start mb-2">
                                                <div class="flex-1">
                                                    <p class="text-[10px] font-black text-emerald-600 uppercase tracking-[0.15em] mb-1">${product.sub}</p>
                                                    <h3 class="font-bold text-lg text-slate-800 leading-tight group-hover:text-emerald-700 transition-colors">${product.name}</h3>
                                                </div>
                                                <div class="flex items-center bg-slate-100 px-2 py-1 rounded-lg text-xs font-bold text-slate-600 ml-2">
                                                    <i data-lucide="star" class="w-3 h-3 text-orange-400 fill-orange-400 mr-1"></i> ${product.rating}
                                                </div>
                                            </div>
                                            <div class="flex items-center text-slate-400 text-[11px] mb-4">
                                                <i data-lucide="map-pin" class="w-3 h-3 mr-1"></i> ${product.location}
                                            </div>
                                            <p class="text-slate-500 text-xs line-clamp-2 mb-6">${product.desc}</p>
                                            <div class="flex items-center justify-between mt-auto">
                                                <div>
                                                    <span class="text-2xl font-black text-slate-900">₹${product.price.toLocaleString()}</span>
                                                    <span class="text-slate-400 text-xs font-medium">/ ${product.unit}</span>
                                                </div>
                                                <button onclick="addToCart(${product.id})" class="group/btn bg-emerald-100 text-emerald-700 p-3 rounded-2xl hover:bg-emerald-600 hover:text-white transition-all active:scale-95">
                                                    <i data-lucide="plus" class="w-6 h-6"></i>
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    </div>
                </div>
            `;

            // Setup search listener
            const searchInput = document.getElementById('searchInput');
            if (searchInput) {
                searchInput.value = state.search;
                searchInput.oninput = (e) => {
                    state.search = e.target.value;
                    render();
                };
            }
        }

        function renderCart(container) {
            const subtotal = state.cart.reduce((acc, curr) => acc + (curr.price * curr.qty), 0);
            const fee = subtotal * 0.02;
            const logistics = subtotal > 0 ? 500 : 0;
            const total = subtotal + fee + logistics;

            if (state.cart.length === 0) {
                container.innerHTML = `
                    <div class="max-w-md mx-auto py-20 text-center animate-fade-in">
                        <div class="bg-slate-100 w-24 h-24 rounded-full flex items-center justify-center mx-auto mb-6">
                            <i data-lucide="shopping-bag" class="w-12 h-12 text-slate-300"></i>
                        </div>
                        <h2 class="text-2xl font-black mb-4">Your Market Bag is Empty</h2>
                        <p class="text-slate-500 mb-8">You haven't added any commodities for procurement yet.</p>
                        <button onclick="navigateTo('marketplace')" class="bg-emerald-600 text-white px-8 py-4 rounded-2xl font-bold shadow-xl shadow-emerald-200">Start Sourcing</button>
                    </div>
                `;
                return;
            }

            container.innerHTML = `
                <div class="max-w-6xl mx-auto animate-fade-in">
                    <div class="flex items-center gap-4 mb-10">
                        <button onclick="navigateTo('marketplace')" class="p-3 bg-white rounded-2xl hover:bg-slate-100 transition-colors shadow-sm">
                            <i data-lucide="chevron-left" class="w-6 h-6"></i>
                        </button>
                        <h1 class="text-3xl font-black">Procurement Cart</h1>
                    </div>

                    <div class="grid lg:grid-cols-3 gap-10">
                        <div class="lg:col-span-2 space-y-4">
                            ${state.cart.map(item => `
                                <div class="bg-white p-5 rounded-[2rem] border border-slate-100 flex items-center gap-6 shadow-sm">
                                    <img src="${item.img}" class="w-24 h-24 rounded-2xl object-cover">
                                    <div class="flex-1">
                                        <p class="text-[10px] font-black text-emerald-600 uppercase tracking-widest">${item.sub}</p>
                                        <h4 class="font-bold text-lg text-slate-800">${item.name}</h4>
                                        <p class="text-emerald-600 font-bold">₹${item.price.toLocaleString()} <span class="text-slate-400 font-medium text-xs">/ ${item.unit}</span></p>
                                    </div>
                                    <div class="flex items-center bg-slate-50 rounded-2xl p-1 px-2 gap-3">
                                        <button onclick="updateQty(${item.id}, -1)" class="w-8 h-8 flex items-center justify-center hover:bg-white rounded-xl transition-colors font-bold text-slate-400">-</button>
                                        <span class="text-sm font-black w-6 text-center">${item.qty}</span>
                                        <button onclick="updateQty(${item.id}, 1)" class="w-8 h-8 flex items-center justify-center hover:bg-white rounded-xl transition-colors font-bold text-emerald-600">+</button>
                                    </div>
                                    <button onclick="removeFromCart(${item.id})" class="p-2 text-slate-300 hover:text-red-500 transition-colors">
                                        <i data-lucide="trash-2" class="w-5 h-5"></i>
                                    </button>
                                </div>
                            `).join('')}
                        </div>

                        <div class="space-y-6">
                            <div class="bg-white p-8 rounded-[2rem] border border-slate-100 shadow-xl shadow-slate-200/50">
                                <h3 class="font-black text-xl mb-6">Order Quote</h3>
                                <div class="space-y-4 text-sm font-semibold text-slate-500">
                                    <div class="flex justify-between"><span>Subtotal</span><span class="text-slate-900">₹${subtotal.toLocaleString()}</span></div>
                                    <div class="flex justify-between"><span>Platform Fee (2%)</span><span class="text-slate-900">₹${fee.toLocaleString()}</span></div>
                                    <div class="flex justify-between"><span>Logistics Estimate</span><span class="text-emerald-600">₹${logistics.toLocaleString()}</span></div>
                                    <div class="h-px bg-slate-100 my-2"></div>
                                    <div class="flex justify-between text-xl font-black text-slate-900"><span>Grand Total</span><span>₹${total.toLocaleString()}</span></div>
                                </div>
                                <button onclick="navigateTo('checkout')" class="w-full bg-emerald-600 hover:bg-emerald-500 text-white py-4 rounded-2xl font-black mt-8 shadow-xl shadow-emerald-200 transition-all flex items-center justify-center gap-2">
                                    Proceed to Checkout <i data-lucide="arrow-right" class="w-5 h-5"></i>
                                </button>
                                <p class="text-[10px] text-center mt-4 text-slate-400">GST-compliant digital invoice will be generated upon confirmation.</p>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderCheckout(container) {
            const subtotal = state.cart.reduce((acc, curr) => acc + (curr.price * curr.qty), 0);
            const fee = subtotal * 0.02;
            const logistics = 500;
            const total = subtotal + fee + logistics;

            container.innerHTML = `
                <div class="max-w-4xl mx-auto animate-fade-in">
                    <div class="flex items-center gap-4 mb-10">
                        <button onclick="navigateTo('cart')" class="p-3 bg-white rounded-2xl hover:bg-slate-100 transition-colors shadow-sm">
                            <i data-lucide="chevron-left" class="w-6 h-6"></i>
                        </button>
                        <h1 class="text-3xl font-black">Checkout</h1>
                    </div>

                    <form id="checkoutForm" onsubmit="handleCheckout(event)" class="grid md:grid-cols-2 gap-8">
                        <div class="space-y-6">
                            <div class="bg-white p-8 rounded-[2rem] border border-slate-100 shadow-sm">
                                <h3 class="font-black text-xl mb-6 flex items-center gap-2"><i data-lucide="user" class="text-emerald-600"></i> Buyer Details</h3>
                                <div class="space-y-4">
                                    <div class="grid grid-cols-2 gap-4">
                                        <input type="text" name="fname" placeholder="First Name" required class="bg-slate-50 border-none rounded-xl px-4 py-3 text-sm focus:ring-2 ring-emerald-500 outline-none w-full">
                                        <input type="text" name="lname" placeholder="Last Name" required class="bg-slate-50 border-none rounded-xl px-4 py-3 text-sm focus:ring-2 ring-emerald-500 outline-none w-full">
                                    </div>
                                    <input type="email" name="email" placeholder="Work Email" required class="bg-slate-50 border-none rounded-xl px-4 py-3 text-sm focus:ring-2 ring-emerald-500 outline-none w-full">
                                    <input type="tel" name="phone" placeholder="Phone Number" required class="bg-slate-50 border-none rounded-xl px-4 py-3 text-sm focus:ring-2 ring-emerald-500 outline-none w-full">
                                </div>
                            </div>

                            <div class="bg-white p-8 rounded-[2rem] border border-slate-100 shadow-sm">
                                <h3 class="font-black text-xl mb-6 flex items-center gap-2"><i data-lucide="map-pin" class="text-emerald-600"></i> Delivery</h3>
                                <div class="space-y-4">
                                    <input type="text" name="address" placeholder="Warehouse / Site Address" required class="bg-slate-50 border-none rounded-xl px-4 py-3 text-sm focus:ring-2 ring-emerald-500 outline-none w-full">
                                    <div class="grid grid-cols-2 gap-4">
                                        <input type="text" name="city" placeholder="City" required class="bg-slate-50 border-none rounded-xl px-4 py-3 text-sm focus:ring-2 ring-emerald-500 outline-none w-full">
                                        <input type="text" name="pincode" placeholder="Pincode" required class="bg-slate-50 border-none rounded-xl px-4 py-3 text-sm focus:ring-2 ring-emerald-500 outline-none w-full">
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="space-y-6">
                            <div class="bg-white p-8 rounded-[2rem] border border-slate-100 shadow-sm">
                                <h3 class="font-black text-xl mb-6 flex items-center gap-2"><i data-lucide="credit-card" class="text-emerald-600"></i> Payment</h3>
                                <div class="space-y-3">
                                    <label class="flex items-center p-4 border-2 border-emerald-500 bg-emerald-50 rounded-2xl cursor-pointer">
                                        <input type="radio" name="pay" value="bank" checked class="w-4 h-4 text-emerald-600">
                                        <div class="ml-4"><p class="font-bold text-sm">RTGS / Bank Transfer</p><p class="text-[10px] text-slate-500">Commercial standard</p></div>
                                    </label>
                                    <label class="flex items-center p-4 border border-slate-100 rounded-2xl cursor-pointer hover:bg-slate-50">
                                        <input type="radio" name="pay" value="lc" class="w-4 h-4 text-emerald-600">
                                        <div class="ml-4"><p class="font-bold text-sm">Letter of Credit</p><p class="text-[10px] text-slate-500">For institutional orders</p></div>
                                    </label>
                                </div>
                                <div class="mt-8 pt-8 border-t border-slate-100">
                                    <div class="flex justify-between text-xl font-black mb-6"><span>Total Amount</span><span>₹${total.toLocaleString()}</span></div>
                                    <button type="submit" class="w-full bg-slate-900 text-white py-4 rounded-2xl font-black hover:bg-slate-800 transition-all">Submit Procurement Order</button>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
            `;
        }

        function handleCheckout(e) {
            e.preventDefault();
            const formData = new FormData(e.target);
            
            const newOrder = {
                id: 'KSN-' + Math.floor(100000 + Math.random() * 900000),
                date: new Date().toLocaleDateString('en-IN', { day: 'numeric', month: 'short', year: 'numeric' }),
                items: [...state.cart],
                subtotal: state.cart.reduce((a, b) => a + (b.price * b.qty), 0),
                total: state.cart.reduce((a, b) => a + (b.price * b.qty), 0) * 1.02 + 500,
                buyer: {
                    name: `${formData.get('fname')} ${formData.get('lname')}`,
                    address: formData.get('address'),
                    city: formData.get('city')
                }
            };

            state.orderHistory.unshift(newOrder);
            localStorage.setItem('kisan360_orders', JSON.stringify(state.orderHistory));
            state.cart = [];
            updateCartCounter();
            navigateTo('confirmation');
        }

        function renderConfirmation(container) {
            const lastOrder = state.orderHistory[0];
            container.innerHTML = `
                <div class="max-w-2xl mx-auto text-center py-10 animate-fade-in">
                    <div class="w-24 h-24 bg-emerald-100 rounded-full flex items-center justify-center mx-auto mb-8 shadow-inner">
                        <i data-lucide="check" class="w-12 h-12 text-emerald-600"></i>
                    </div>
                    <h1 class="text-4xl font-black mb-4">Order Placed Successfully!</h1>
                    <p class="text-slate-500 mb-10">Order Reference: <span class="font-bold text-slate-900">${lastOrder.id}</span></p>
                    
                    <div class="bg-white rounded-[2rem] p-8 border border-slate-100 shadow-xl text-left mb-10">
                        <h4 class="font-bold text-sm uppercase tracking-widest text-slate-400 mb-6">Order Summary</h4>
                        <div class="space-y-4 mb-8">
                            ${lastOrder.items.map(i => `
                                <div class="flex justify-between items-center">
                                    <div><p class="font-bold text-slate-800">${i.name}</p><p class="text-[10px] text-slate-500">${i.qty} × ${i.unit}</p></div>
                                    <span class="font-bold">₹${(i.price * i.qty).toLocaleString()}</span>
                                </div>
                            `).join('')}
                        </div>
                        <div class="pt-6 border-t border-slate-100 flex justify-between items-center font-black text-xl">
                            <span>Total Due</span>
                            <span class="text-emerald-600">₹${Math.round(lastOrder.total).toLocaleString()}</span>
                        </div>
                    </div>

                    <div class="flex gap-4 justify-center">
                        <button onclick="navigateTo('marketplace')" class="bg-slate-100 text-slate-900 px-8 py-4 rounded-2xl font-bold hover:bg-slate-200 transition-all">Back to Market</button>
                        <button onclick="navigateTo('history')" class="bg-emerald-600 text-white px-8 py-4 rounded-2xl font-bold shadow-xl shadow-emerald-200 hover:bg-emerald-700 transition-all">View My History</button>
                    </div>
                </div>
            `;
        }

        function renderHistory(container) {
            if (state.orderHistory.length === 0) {
                container.innerHTML = `
                    <div class="max-w-md mx-auto py-20 text-center animate-fade-in">
                        <div class="bg-slate-100 w-24 h-24 rounded-full flex items-center justify-center mx-auto mb-6">
                            <i data-lucide="history" class="w-12 h-12 text-slate-300"></i>
                        </div>
                        <h2 class="text-2xl font-black mb-4">No Purchase History</h2>
                        <button onclick="navigateTo('marketplace')" class="bg-emerald-600 text-white px-8 py-4 rounded-2xl font-bold">Explore Market</button>
                    </div>
                `;
                return;
            }

            container.innerHTML = `
                <div class="max-w-4xl mx-auto animate-fade-in">
                    <h1 class="text-3xl font-black mb-10">Order History</h1>
                    <div class="space-y-6">
                        ${state.orderHistory.map(order => `
                            <div class="bg-white rounded-[2rem] border border-slate-100 p-8 shadow-sm overflow-hidden relative">
                                <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 mb-8">
                                    <div>
                                        <p class="text-[10px] font-black text-emerald-600 uppercase tracking-widest mb-1">Confimed Order</p>
                                        <h3 class="text-xl font-black text-slate-900">${order.id}</h3>
                                        <p class="text-xs text-slate-500 font-medium">${order.date}</p>
                                    </div>
                                    <div class="text-right">
                                        <p class="text-xs text-slate-400 font-bold mb-1 uppercase tracking-tighter">Total Amount Paid</p>
                                        <p class="text-2xl font-black text-slate-900">₹${Math.round(order.total).toLocaleString()}</p>
                                    </div>
                                </div>
                                <div class="grid sm:grid-cols-2 lg:grid-cols-3 gap-6 pt-8 border-t border-slate-50">
                                    ${order.items.map(item => `
                                        <div class="flex items-center gap-3">
                                            <img src="${item.img}" class="w-12 h-12 rounded-xl object-cover">
                                            <div>
                                                <p class="text-sm font-bold text-slate-800 line-clamp-1">${item.name}</p>
                                                <p class="text-[10px] text-slate-500 font-medium">${item.qty} × ${item.unit}</p>
                                            </div>
                                        </div>
                                    `).join('')}
                                </div>
                                <div class="mt-8 pt-6 border-t border-slate-50 flex items-center justify-between">
                                    <div class="flex items-center gap-2 text-emerald-600">
                                        <i data-lucide="truck" class="w-4 h-4"></i>
                                        <span class="text-xs font-bold">Shipped to ${order.buyer.city}</span>
                                    </div>
                                    <button class="text-emerald-600 text-xs font-black uppercase tracking-widest hover:underline">Download Invoice</button>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            render();
            updateCartCounter();
        });
    </script>
</body>
</html>